if game:GetService("RunService"):IsClient() then
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ArrestGUI"
    screenGui.Parent = game.Players.LocalPlayer.PlayerGui
    screenGui.ResetOnSpawn = false
    screenGui.Enabled = true

    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 0.3, 0, 150)
    mainFrame.Position = UDim2.new(0.5, -mainFrame.Size.X.Offset / 2, 0.5, -mainFrame.Size.Y.Offset / 2)
    mainFrame.BackgroundColor3 = Color3.new(1, 1, 1)
    mainFrame.BackgroundTransparency = 0.5
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    mainFrame.Draggable = true
    mainFrame.ClipsDescendants = true

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 15)
    UICorner.Parent = mainFrame

    local playerTextBox = Instance.new("TextBox")
    playerTextBox.Size = UDim2.new(0.8, 0, 0.3, 0)
    playerTextBox.Position = UDim2.new(0.1, 0, 0.1, 0)
    playerTextBox.PlaceholderText = "Player Name"
    playerTextBox.Parent = mainFrame

    local arrestButton = Instance.new("TextButton")
    arrestButton.Size = UDim2.new(0.8, 0, 0.3, 0)
    arrestButton.Position = UDim2.new(0.1, 0, 0.5, 0)
    arrestButton.BackgroundColor3 = Color3.new(0.7, 0.7, 0.7)
    arrestButton.Text = "Arrest 'Em"
    arrestButton.Parent = mainFrame

    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0.2, 0, 0.2, 0)
    closeButton.Position = UDim2.new(0.8, 0, 0, 0)
    closeButton.BackgroundColor3 = Color3.new(1, 0, 0)
    closeButton.Text = "X"
    closeButton.Parent = mainFrame

    closeButton.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)

    arrestButton.MouseButton1Click:Connect(function()
        local playerName = playerTextBox.Text
        if playerName and playerName ~= "" then
            game.ReplicatedStorage.ArrestPlayer:FireServer(playerName)
        end
    end)

    -- Mobile dragging
    local dragging = nil
    local dragInput = nil
    local dragStart = nil
    local dragGuiStart = nil

    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragInput = input
            dragStart = input.Position
            dragGuiStart = mainFrame.Position
        end
    end)

    mainFrame.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(dragGuiStart.X.Scale, dragGuiStart.X.Offset + delta.X, dragGuiStart.Y.Scale, dragGuiStart.Y.Offset + delta.Y)
        end
    end)

    mainFrame.InputEnded:Connect(function(input)
        if dragging and input == dragInput then
            dragging = false
        end
    end)

else -- Server Side

    local function arrestPlayer(playerName, arrestingPlayer)
        local targetPlayer = game.Players:FindFirstChild(playerName)
        if targetPlayer and targetPlayer.Character then
            local targetCharacter = targetPlayer.Character
            local arrestingCharacter = arrestingPlayer.Character

            if arrestingCharacter and arrestingCharacter:FindFirstChild("HumanoidRootPart") and targetCharacter:FindFirstChild("HumanoidRootPart") then
                arrestingCharacter.HumanoidRootPart.CFrame = targetCharacter.HumanoidRootPart.CFrame * CFrame.new(0, 2, 0) -- Teleport above target
                
                local handcuffs = game.ReplicatedStorage:FindFirstChild("Handcuffs")
                if handcuffs then
                    local clonedHandcuffs = handcuffs:Clone()
                    clonedHandcuffs.Parent = targetPlayer.Backpack
                    clonedHandcuffs.Parent = targetCharacter
                else
                    warn("Handcuffs tool not found in ReplicatedStorage")
                end
            else
                warn("Arresting or target player character not fully loaded.")
            end
        else
            warn("Player not found: ", playerName)
        end
    end

    local ArrestPlayerEvent = Instance.new("RemoteEvent")
    ArrestPlayerEvent.Name = "ArrestPlayer"
    ArrestPlayerEvent.Parent = game.ReplicatedStorage

    ArrestPlayerEvent.OnServerEvent:Connect(function(player, playerName)
        arrestPlayer(playerName, player)
    end)
end
