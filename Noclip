local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local localPlayer = Players.LocalPlayer
local mouse = localPlayer:GetMouse()

local rawMetatable = getrawmetatable(game)
local originalIndex = rawMetatable.__index
local originalNewIndex = rawMetatable.__newindex
local originalNameCall = rawMetatable.__namecall
local isTrustedCaller = checkcaller or is_protosmasher_caller

local noClipEnabled = false
local noClipToggleKey = Enum.KeyCode.X -- Use Enum.KeyCode for clarity

setreadonly(rawMetatable, false)

-- Notification Function (Replace with your preferred notification method)
local function showNotification(title, message, duration)
    -- Replace this with your notification implementation
    warn("Notification: " .. title .. " - " .. message)
    wait(duration)
end

showNotification("zxciaz", "Press F9 for Directions", 4)
warn("NoClip + Bypass made by zxciaz")
warn("Press " .. noClipToggleKey.Name .. " to turn off and on NoClip")

-- Metatable Modification
rawMetatable.__newindex = newcclosure(function(self, property, value)
    if isTrustedCaller() then
        return originalNewIndex(self, property, value)
    end

    if tostring(self) == "HumanoidRootPart" or tostring(self) == "Torso" then
        if property == "CFrame" and self:IsDescendantOf(localPlayer.Character) then
            return true -- Credits to ze_lI for this
        end
    end

    return originalNewIndex(self, property, value)
end)

setreadonly(rawMetatable, true)

-- NoClip Toggle
local function toggleNoClip()
    noClipEnabled = not noClipEnabled
    showNotification("zxciaz", "NoClip: " .. tostring(noClipEnabled), 3)

    local character = localPlayer.Character
    if character and character:FindFirstChild("Humanoid") then
        local humanoid = character:FindFirstChild("Humanoid")
        if noClipEnabled then
            humanoid.WalkSpeed = 0
            humanoid.JumpPower = 0
        else
            humanoid.WalkSpeed = 16 -- Reset to default walk speed
            humanoid.JumpPower = 50 -- Reset to default jump power
        end
    end
end

-- Input Handling
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if input.KeyCode == noClipToggleKey and not gameProcessedEvent then
        toggleNoClip()
    end
end)
