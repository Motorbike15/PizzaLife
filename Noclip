local NoclipEnabled = false
local Player = game:GetService("Players").LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- Create a toggle button (replace with your actual button creation)
local ToggleButton = Instance.new("TextButton") 
ToggleButton.Parent = -- Your GUI location
ToggleButton.Text = "Toggle Noclip (E)"

-- Function to enable/disable noclip
local function ToggleNoclip()
    NoclipEnabled = not NoclipEnabled

    if NoclipEnabled then
        -- Disable collisions for all character parts EXCEPT HumanoidRootPart
        for _, part in pairs(Character:GetDescendants()) do
            if part:IsA("BasePart") and part ~= HumanoidRootPart then
                part.CanCollide = false
            end
        end
        -- Set PlatformStand to prevent weird walking animation
        Humanoid.PlatformStand = true
    else
        -- Re-enable collisions and reset PlatformStand
        for _, part in pairs(Character:GetDescendants()) do
            if part:IsA("BasePart") and part ~= HumanoidRootPart then
                part.CanCollide = true
            end
        end
        Humanoid.PlatformStand = false
    end
end

-- Connect the button and keybind
ToggleButton.MouseButton1Click:Connect(ToggleNoclip)
game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.E and not gameProcessed then
        ToggleNoclip()
    end
end)
