local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")

local noclip = false

function toggleNoclip()
	noclip = not noclip
	if noclip then
		for _, part in pairs(character:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	else
		for _, part in pairs(character:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = true
			end
		end
	end
end

userInputService.InputBegan:Connect(function(input, gameProcessed)
	if not gameProcessed and input.KeyCode == Enum.KeyCode.N then
		toggleNoclip()
	end
end)

runService.RenderStepped:Connect(function()
	if noclip then
		for _, part in pairs(workspace:GetChildren()) do
			if part:IsA("BasePart") and part.Transparency < 0.5 then
				local distance = (character.HumanoidRootPart.Position - part.Position).magnitude
				if distance < 10 then
					part.Transparency = 0.5
				else
					part.Transparency = 0
				end
			end
		end
	end
end)
